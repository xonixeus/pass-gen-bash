#!/bin/bash
# http://stackoverflow.com/questions/1466709/improve-my-password-generation-script
# THIRD VERSION OF THE PASSWORD GENERATOR SCRIPT
# BY DEFAULT, IT GENERATES A RANDOM 24 CHARACTER PASSWORD USING;
# LOWERCASE, UPPERCASE LETTERS, NUMBERS & SYMBOLS
# HOWEVER, IT ALSO ACCEPTS OPTIONS (e.g. -c & -l),
# WHERE OPTIONS CAN BE PASSED TO SPECIFY WHICH CHARACTER TYPES TO USE
# AND THE LENGHT, AS LONG AS IT'S GREATER THAN 11 CHARACTERS!

LEN=24
RND=/dev/urandom
alpha=`echo {a..z} | tr -d ' '`
ALPHA=`echo {A..Z} | tr -d ' '`
DIGIT=`echo {0..9} | tr -d ' '`
CHAR="!@$%&(){}?"

while getopts "c:l:" opt; do
    case "${opt}" in
        c) args=$OPTARG ;;
        l) LEN=$OPTARG ;;
    esac
done

# LOWERCASE LETTERS ONLY!
if ( [[ "$args" == "a" && "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha" | head -c $LEN)
    done
    echo -e $pass '\n'

# UPPERCASE LETTERS ONLY!
elif ( [[ "$args" == "A" && "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$ALPHA] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$ALPHA" | head -c $LEN)
    done
    echo -e $pass '\n' 

# NUMBERS ONLY!
elif ( [[ "$args" == "D" && "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$DIGIT] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$DIGIT" | head -c $LEN)
    done
    echo -e $pass '\n'

# SPECIAL CHARACTERS ONLY!
elif ( [[ "$args" == "C" && "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWER & UPPERCASE LETTERS!
elif ( [[ "$args" == "aA" ]] || [[ "$args" == "Aa" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$ALPHA] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$ALPHA" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWERCASE & DIGITS!
elif ( [[ "$args" == "aD" ]] || [[ "$args" == "Da" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$DIGIT] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$DIGIT" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWERCASE & SPECIAL CHARACTERS!
elif ( [[ "$args" == "aC" ]] || [[ "$args" == "Ca" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# UPPERCASE & DIGITS!
elif ( [[ "$args" == "AD" ]] || [[ "$args" == "DA" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$ALPHA] | grep [$DIGIT] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$ALPHA$DIGIT" | head -c $LEN)
    done
    echo -e $pass '\n'

# UPPERCASE & SPECIAL CHARACTERS!
elif ( [[ "$args" == "AC" ]] || [[ "$args" == "CA" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$ALPHA] | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$ALPHA$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# SPECIAL CHARACTERS & DIGITS!
elif ( [[ "$args" == "CD" ]] || [[ "$args" == "DC" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$CHAR] | grep [$DIGIT] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$CHAR$DIGIT" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWERCASE, UPPERCASE & DIGITS!
elif ( [[ "$args" == "aAD" ]] || [[ "$args" == "aDA" ]] || [[ "$args" == "ADa" ]] || [[ "$args" == "DAa" ]] || [[ "$args" == "AaD" ]] || [[ "$args" == "DaA" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$ALPHA] | grep [$DIGIT] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$ALPHA$DIGIT" | head -c $LEN)
    done
    echo -e $pass '\n'

# UPPERCASE, DIGITS & SPECIAL CHARACTERS!
elif ( [[ "$args" == "ACD" ]] || [[ "$args" == "ADC" ]] || [[ "$args" == "CDA" ]] || [[ "$args" == "DCA" ]] || [[ "$args" == "CAD" ]] || [[ "$args" == "DAC" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$ALPHA] | grep [$DIGIT] | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$ALPHA$DIGIT$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWERCASE, UPPERCASE & SPECIAL CHARACTERS!
elif ( [[ "$args" == "aAC" ]] || [[ "$args" == "aCA" ]] || [[ "$args" == "ACa" ]] || [[ "$args" == "CAa" ]] || [[ "$args" == "AaC" ]] || [[ "$args" == "CaA" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$ALPHA] | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$ALPHA$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# LOWERCASE, DIGITS & SPECIAL CHARACTERS!
elif ( [[ "$args" == "aCD" ]] || [[ "$args" == "aDC" ]] || [[ "$args" == "CDa" ]] || [[ "$args" == "DCa" ]] || [[ "$args" == "CaD" ]] || [[ "$args" == "DaC" ]] && [[ "$LEN" -gt 11 ]] ); then
    until [ $(echo $pass | grep [$alpha] | grep [$DIGIT] | grep [$CHAR] ) ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$DIGIT$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n'

# NO '-c' OPTION!
elif [[ -z $args && "$LEN" -gt 11 ]]; then
    until [ $(echo $pass | grep [$alpha] | grep [$ALPHA] | grep [$DIGIT] | grep -c [$CHAR] ) == 1 ]; do
        pass=$(cat $RND | LC_CTYPE=C tr -cd "$alpha$ALPHA$DIGIT$CHAR" | head -c $LEN)
    done
    echo -e $pass '\n';  

else
    echo -e "Length option (i.e. -l) MUST HAVE an argument greather than eleven (11)!\n"
fi
